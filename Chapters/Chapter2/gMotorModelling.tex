\subsection{Motor modelling}
A model of a motor consist of both a mechanical and an electrical section, due to the electrical current, $i_a(t)$, conversion into a rotational force called torque, $\tau_m$. Therefore a model of the mechanical and the electrical system is produced. The electrical model provides the motors torque and the mechanical model from the motor provides what contributions the motor delivers to the drivetrain, see \secref{DriveTrain}.

\subsubsection{Electrical and mechanical model}
The output from the motors electrical model is torque, $\tau_m$. To obtain torque the formula for translating the electrical current, $i_a$, to torque is utilized:

\begin{flalign}\centering
  \tau_m = K_t \cdot i_a(t) %\unit{\volt}
  \label{equ:motortorque}
\end{flalign}
\hspace{6mm} Where:\\
\begin{tabular}{p{1cm}ll}
& $\tau_m$ & the rotational force torque [$N \cdot m$] \\
& $i_a(t)$ & the electrical closed loop current [$A$]\\
& $K_t$ & the torque constant [$\frac{N \cdot m}{A}$] \\
\end{tabular}

An expression for the current, $i_a$, is required to derive a model for the electrical system. In \figref{fig:MotorElectric} an electrical diagram of the motor is display.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.8]{figures/MotorElektrikDiagram.jpg}
	\caption{Electric diagram of the motor}
	\label{fig:MotorElectric}
\end{figure}

By using Kirchoffs voltage law on the closed loop, seen in \figref{fig:MotorElectric}, an expression including $i_a$ can be derived:

\begin{flalign}\centering
V_a(t) = R_a \cdot i_a(t) + L_a \cdot \frac{di_a}{dt} + e_b 
\label{MotorClosedLoop}
\end{flalign}
\hspace{6mm} Where:\\
\begin{tabular}{p{1cm}ll}
& $V_a(t)$ & the supply voltage [$V$] \\
& $R_a$ & the eternal resistance in the motor [$\Omega$]\\
& $L_a$ & the inductance in the motor [$H$] \\
& $e_b$ & the electromotive force, also called EMF [$\V$] \\
\end{tabular}

The electromotive force, $e_b$, is equivalent to:

\begin{flalign}\centering
e_b = K_e \cdot \dot{\theta}_m 
\end{flalign}
\hspace{6mm} Where:\\
\begin{tabular}{p{1cm}ll}
& $K_e$ & the electromotive constant [$Wb$] \\
& $\dot{\theta}_m$ & the angular velocity in the motor [$\frac{rad}{s}$] \\
\end{tabular}

the equivalent for the electromotive force is substituted into \eqref{MotorClosedLoop}.

\begin{flalign}\centering
V_a(t) = R_a \cdot i_a(t) + L_a \cdot \frac{di_a}{dt} + K_e \cdot \dot{\theta}_m(t)
\end{flalign}

The Laplace transform is applied to the derived equation:

\begin{flalign}\centering
V_a(s) = R_a \cdot i_a(s) + L_a \cdot s \cdot i_a(s) + K_e \cdot \dot{\theta}_m(s) 
\end{flalign}

The equation is solved for $i_a$:

\begin{flalign}\centering
i_a(s) = \frac{V_a(s) - K_e \cdot \dot{\theta}_m(s)}{sL_a + R_a} 
\end{flalign}

By substituting the derived equation for $i_a$ into \eqref{equ:motortorque}, a new expression for the motors torque is derived. 

\begin{flalign}\centering
  \tau_m = K_t \cdot i_a(s) = K_t \cdot \frac{V_a(s) - K_e \cdot \dot{\theta}_m(s)}{sL_a + R_a}  %\unit{\volt}
  \label{eq:Totaltorquewithcurrentexpression}
\end{flalign}

Newtons second law of motion for rotational systems yields, that torque is equal:

\begin{flalign}\centering
I_m \cdot \ddot{\theta}_m(t) = \tau_m - B \cdot \dot{\theta}_m(t)
\label{eq:mechanicalmodel}
\end{flalign}
\begin{flalign}\centering
\tau_m(t) = I_m(t) \cdot \ddot{\theta}_m(t) + B \cdot \dot{\theta}_m(t)
\end{flalign}
\hspace{6mm} Where:\\
\begin{tabular}{p{1cm}ll}
& $I_m$ & the motors inertia [$kg*m^2 $] \\
& $\ddot{\theta}_m$ & the angular acceleration in the motor [$\frac{rad}{s^2}$] \\
\end{tabular}

Newtons second law of motion for rotating systems is used in the mechanical model. In \figref{fig:MotorMechanicalModel} a diagram is displaying the different directions of the forces affecting the model, which is equal the Newtons second law of motion for rotating systems, as seen in \eqref{eq:mechanicalmodel}.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.8]{figures/MotorMechanicalModel.pdf}
	\caption{Free body diagram of the motor}
	\label{fig:MotorMechanicalModel}
\end{figure}

\begin{flalign}\centering
\tau_m = I_m(s) \cdot \ddot{\theta}_m(s) + B \cdot \dot{\theta}_m(s)
\end{flalign}

The angular acceleration is differentiated to be able to isolate the angular velocity:

\begin{flalign}\centering
\tau_m = I_m(s) \cdot \dot{\theta}_m(s) \cdot s + B \cdot \dot{\theta}_m(s) \nonumber
\end{flalign}

\begin{flalign}\centering
\dot{\theta}_m(s) = \frac{\tau_m(s)}{I_m(s) \cdot s+B}
\label{eq:ThetadotforBlock}
\end{flalign}

\eqref{eq:ThetadotforBlock} and \eqref{eq:Totaltorquewithcurrentexpression} delivers the information needed to make a visual representation of the motor model. The input is the supply voltage, $V_a(s)$ delivered to the motor and the output is the required torque$\tau_m$, see \figref{fig:motormodelBlock}. The block representation of the system can also be used, when the system is simulated.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.3]{figures/motormodelBlock.png}
	\caption{Free body diagram of the motor}
	\label{fig:motormodelBlock}
\end{figure}

Now the model of the motor has been formed, the next step would therefore be to model the drivetrain, which borders is from the gear connected to the motor to the front wheel.